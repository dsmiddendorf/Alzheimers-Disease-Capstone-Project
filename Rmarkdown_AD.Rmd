---
title: "Alzheimer's Disease and its Biopsychosocial Determinants"
author: "Daniel Middendorf"
date: "1/3/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
##########################################################
# Create alzheimer set, validation set (final hold-out test set)
##########################################################

# Downloading required libraries for analysis if they have not been downloaded yet
if(!require(tidyverse)) install.packages("tidyverse")
if(!require(caret)) install.packages("caret")
if(!require(readr)) install.packages("readr")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(psych)) install.packages("psych")
if(!require(ggthemes)) install.packages("ggthemes")
if(!require(cowplot)) install.packages("cowplot")
if(!require(corrplot)) install.packages("corrplot")
if(!require(glmnet)) install.packages("glmnet")
if(!require(knitr)) install.packages("knitr")

# Loading libraries used for the following analysis
library(tidyverse)
library(caret)
library(readr)
library(ggplot2)
library(psych)
library(ggthemes)
library(cowplot)
library(corrplot)
library(glmnet)
library(knitr)

# Loading data 
dat <- read_csv("https://raw.githubusercontent.com/dsmiddendorf/Alzheimers-Disease-Capstone-Project/main/oasis_longitudinal.csv")
dat[,c("Hand")] <- NULL # Removing column including handedness as all participants were dextrals

# Change variable name for sex from "M/F" to "Sex"
names(dat)[6] <- "Sex" 

# Validation set will be 10% of the original dataset
set.seed(1, sample.kind="Rounding") # if using R 3.5 or earlier, use `set.seed(1)`
test_index <- createDataPartition(y = dat$Group, times = 1, p = 0.1, list = FALSE)
alzheimer <- dat[-test_index,]
validation <- dat[test_index,]
rm(test_index, dat) # Removing original dataset and test index
```

# 1. Introduction
Dementia is the general intellectual deterioration resulting form brain alterations caused by pathology or normal aging. However, against popular belief, excessive forms of dementia are not part of the normal aging process and should be evaluated neuropsychologically. Neurodegenerative diseases, including Alzheimer's Disease (AD) accounting for 60-80% of all dementia cases, are the most prevalent cause of such symptoms and usually occur in old age. Despite the prevalence of such diseases, no cure has developed yet and neuropharmacological drugs can only alliviate the symptoms but not the causes. As the etiology of such diseases remained unclear, the past thirty years have seen increasingly rapid advances in the field of disease correlates and predictors. The most frequently reported correlates and predictors include: Gender, Age, Education, Socioeconomic Status, and neurophysiological brain correlates (e.g., normalized whole brain volume (nWBV), eTIV (estimated intercranial volume), atlas scaling factor (ASF)). Up to now, far too little attention has been paid to the combined effects of those predictors/correlates. Hence, this paper attempts to find a well-fitting model combining the named risk factors to determine which patients might suffer from dementia or not. Prior to this project, patients underwent a Clinical Dementia Rating by which they were classified as either "demented" or "nondemented" and further underwent extensive medical and neuropsychological examinations. Most patients were investigated more than once; however, in regard to the aim of this project this was not taken into account in the following analyses.


## 1.1 Description of the Dataset
The dataset that will be used for our prediction includes 335 rows and 14 columns. Each row represents a examination point of an individual patient. The scale for CDR, our dependent variable, ranges from 0 to 3 with 0 indicating no dementia and 3 indicating severe cognitive decline. 

```{r message=FALSE, , echo=F}
df <- data.frame(Name = c("Sex", "Age", "EDUC", "SES", "MMSE", "CDR", "eTIV", "nWBV", "ASF"),
                 Description = c("Gender", "Age", "Education", "Socioeconomic Status", "Mini Mental Status Examination", "Clinical Dementia Rating",
                                 "Total Intercranial Volume", "Normalized Whole Brain Volume", "Atlas Scaling Factor"))

kable(df)
```


### Clinical Dementia Rating (CDR)
>"Clinical Dementia Rating(CDR) ranges between 0 and 3 which
depends on the issues and leisure activities of the Alzheimer’s
patient. CDR is attributed with having the option to recognize
gentle hindrances, however its shortcomings incorporate the
measure of time it takes to control, its definitive dependence
on emotional evaluation, and relative powerlessness to catch
changes over time." (Kishore et al., 2020)

```{r , echo = F, message = F}
df <- data.frame(Name = c("0", "0.5", "1", "2", "3"),
                 Description = c("None", "Very Mild", "Mild", "Moderate", "Severe"))

kable(df)
```


### Mini Mental Status Examination (MMSE)
> "The Mini-Mental State Examination (MMSE) or Folstein test is a
30-point poll that is utilized broadly in clinical and inquire about
settings to quantify psychological impairment. It is usually utilized
in medication and unified wellbeing to screen for dementia. It is
likewise used to gauge the seriousness and movement of psychological
impedance and to follow the course of subjective changes
in a person after some time; in this way making it a successful
method to record a person’s reaction to treatment." (Kishore et al., 2020)

Although this measure is useful in assessing dementia, we decided to drop this variable at the expense of CDR from the following analysis as CDR involves more involvement of the diagnosing expert. Furthermore, CDR provides us with a clear cut of between "demented" and "nondemented" whereas the MMSE assesses cognitive ability on a nearly complete dimensional model.

### Total Intercranial Volume (eTIV)

> "Estimated Total Intracranial Volume (eTIV) gives the volume of
void spaces in the brain. In the event that eTIV isn’t one-sided, its
difference ought to be irregular past that clarified by the genuine
intracranial volume." (Kishore et al., 2020)

### Normalized Whole Brain Volume (nWBV)
> "Normalize Whole Brain Volume(nWBV) gives the volume of
brain other than void spaces." (Kishore et al., 2020)

### Atlas Scaling Factor (ASF)
> "Atlas Scaling Factor(ASF) is directly proportional to the eTIV and
nWBV. Atlas Scaling Factor characterized as the volume-scaling
factor required to coordinate every person to the chart book target.
Since chart book standardization likens head size, the ASF ought to
be relative to TIV." (Kishore et al., 2020)

## 1.2 Descriptive Statistics

Following you can see the first six rows of the dataset used to predict dementia:

```{r , echo = F}
head(alzheimer)
```

General summary statistics of the dataset:
```{r , echo = F}
head(alzheimer)
describe(alzheimer[,2:9])
```


The Gender Distribution:
```{r , echo = F}
table(alzheimer$Sex)/nrow(alzheimer)
```

The number of unique participants:
```{r , echo = F}
length(unique(alzheimer$`Subject ID`))
```

## 1.3 Visualization of Descriptive Statistics

Density diagrams of the numerical data involved. You can see that the relevant variables are approximately normally distributed. Only MMSE is not; however, we do not include this variable in the following analysis anyway. If the data is strongly skewed, this could pose a problem to some models. 
```{r Density Diagramms, echo = F, fig.align='center', comment = "", message = F, results='hide',fig.keep='all'}
# Create Density Diagrams for continuous variables

## Density Plot for Age
dage <- alzheimer %>% ggplot(aes(Age)) + geom_density() + theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank())

## Density Plot for Education
deduc <- alzheimer %>% ggplot(aes(EDUC)) + geom_density() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())

## Density Plot for MMSE (Mini Mental Status Examination)
dmmse <- alzheimer %>% ggplot(aes(MMSE)) + geom_density() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())

## Density Plot for eTIV
detiv <- alzheimer %>% ggplot(aes(eTIV)) + geom_density() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())

## Density Plot for nWBV
dnwbv <- alzheimer %>% ggplot(aes(nWBV)) + geom_density() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())

## Density Plot for ASF
dasf <- alzheimer %>% ggplot(aes(ASF)) + geom_density() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())

# Putting all Density Plots together in one Figure
density_plots <- plot_grid(dage, deduc, dmmse, detiv, dnwbv, dasf)
density_plots
```

Bar plots of the categorical or ordinal data. You can see that most of the participants were female and most participants did not suffer from dementia. The data also includes participants form a wide range of social classes, which can be seen upon closer inspection of the SES distribution. 

```{r Bar Plots, echo = F, fig.align='center', comment = "", message = F, results='hide',fig.keep='all'}
# Create barplots for categorical/ordinal data

## Barplot for Sex
x <- alzheimer %>% ggplot(aes(Sex)) + geom_bar() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())

## Barplot for Socioeconomic Status
y <- alzheimer %>% ggplot(aes(SES)) + geom_bar() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())

## Barplot for CDR
z <- alzheimer %>% ggplot(aes(CDR)) + geom_bar() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
plot_grid(x,y,z)
rm(x,y,z)
```

## 1.4 Bivariate Examination of the Data

Following you can see a simple correlation plot between the the numerical variables in this dataset. On the top half you can see the p-values associated with the correlations and on the bottom you can see the real Pearson correlations. We can observe significant associations between CDR and Education and nWBV. This is in line with previous research identifying Education as a protection factor and nWBV as a brain correlate to neurodegenerative diseases like dementia (Cohen, 1994). 

```{r Correlation Plot, echo = F, fig.align='center', comment = "", message = F, results='hide',fig.keep='last'}
pval <- psych::corr.test(alzheimer[,c(5,7,8,11,12,13,14)], adjust="none")$p # Calculating p-values for the different correlations
pval[pval >= .05] <- NA # Removing p-values above .05
corrplot(cor(alzheimer[,c(5,7,8,11,12,13,14)]), type="upper", p.mat=pval, insig="p-value", 
         tl.pos="n", sig.level=0) # Plotting the upper half of the correlation matrix with p-values

corrplot(cor(alzheimer[,c(5,7,8,11,12,13,14)]), type="lower", add=T, tl.pos="d", cl.pos="n", addCoef.col = T) # Plotting the lower part with correlations
```

Further we investigated the relation between CDR and and the categorical/ordinal variables Sex and SES. Both variables seem dependent from each other with a p-value below .01. 
```{r Chi Square Test for Categorical/Ordinal Data, warning = F, echo = F}
chisq.test(alzheimer$Sex, alzheimer$CDR)
chisq.test(alzheimer$Sex, alzheimer$SES)
```

Finally, as we were unable to find a description of the column Group; we thought that this column might be the collapsed CDR variable. Group includes the levels "converted", "demented", and "nondemented." As you can see only two observations are not fitting if a CDR of 0 is characterized as "nondemented" and all other scorings are characterized as "demented." The category "converted" rightfully includes participants who were at first "nondemented" and converted to "demented." We conclude that the column Group and CDR are the same with two exceptions. These exceptions cannot be explained without having gathered the data ourselves. Following you can also see data from the two participants who do not fit into the classification schema. 

```{r CDR and Group Column the Same, echo = F, fig.align='center', comment = "", message = F,fig.keep='all'}
# Are the variables CDR and Group the same?
## Creating a barplot of Group ('converted', 'demented', 'Nondemented') filled by CDR
alzheimer %>% ggplot(aes(Group, fill = as.factor(CDR))) + geom_bar() + theme_bw() +
  theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank())
## Selecting two participants who would not fit if both variables would be the same
alzheimer[which(alzheimer$CDR == .5 & alzheimer$Group == "Nondemented"),] 
# -> It seems like CDR and Group are the same variable; group is just a collapsed form
# Nevertheless, there are two entries that do not fit. 
```


# 2. Methods and Analysis

# 2.1 Methods
As the data includes missing values and the dataset is relatively small, those values were replaced by the median.

```{r Missing Values, echo = F, fig.align='center', comment = "", results = F, message = F,fig.keep='all'}
# Replace missing values (NA) with median values
alzheimer$SES[is.na(alzheimer$SES)] <- median(alzheimer$SES, na.rm = T)
alzheimer$MMSE[is.na(alzheimer$MMSE)] <- median(alzheimer$MMSE, na.rm = T)
validation$SES[is.na(validation$SES)] <- median(validation$SES, na.rm = T)
validation$MMSE[is.na(validation$MMSE)] <- median(validation$MMSE, na.rm = T)
```

In order to determine whether participants might suffer from dementia or not, we collapsed the CDR variable into a binary variable: "0", nondemented and "1", demented.

```{r Collapsing CDR, echo = F, fig.align='center', comment = "", results = F, message = F,fig.keep='all'}
# Collapsing the CDR variable into 0, Nondemented and 1 Demented, new variable is collapsed CDR (cCDR)
alzheimer$cCDR <- ifelse(alzheimer$CDR %in% c(0.5,1,2), 1, 0)
alzheimer$cCDR <- as.factor(alzheimer$cCDR)
alzheimer$CDR <- as.factor(alzheimer$CDR)

validation$cCDR <- ifelse(validation$CDR %in% c(0.5,1,2), 1, 0)
validation$cCDR <- as.factor(validation$cCDR)
validation$CDR <- as.factor(validation$CDR)
```

To identify possible threats of Multicollinearity, we employed a correlation cutoff of .75. From this two variable are dropped from further analyses. 

```{r Multicollinearity, echo = F, fig.align='center', comment = "", message = F, warning=F}
numeric_variables <- alzheimer[, sapply(alzheimer, is.numeric)]
correlations<-cor(numeric_variables)
highCorr<-findCorrelation(correlations, cutoff = .75)
numeric_variables<-numeric_variables[,highCorr] # Dropping ASF and 'MR Delay' because of Multicollinearity
head(numeric_variables)
```

# 2.2 Analysis

# 3. Results

# 4. Conclusion

# 5. References
Cohen, C. I. (1994). Education, occupation, and alzheimer's disease. Jama: The Journal of the American Medical Association, 272(18), 1405–1405. https://doi.org/10.1001/jama.272.18.1405c

Kishore, P., Usha Kumari, C., Kumar, M. N. V. S. S., & Pavani, T. (2020). Detection and analysis of alzheimer’s disease using various machine learning algorithms. Materials Today: Proceedings. https://doi.org/10.1016/j.matpr.2020.07.645